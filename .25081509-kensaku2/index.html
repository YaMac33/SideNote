<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ï¼šè¨˜äº‹å†…å®¹ã‚’ç«¯çš„ã«è¡¨ç¾ -->
  <title>25.8.15 09-2 Algolia ã¨ Lunr.js ã§ä½œã‚‹é™çš„ã‚µã‚¤ãƒˆæ¤œç´¢ â€” è‡ªå‹•åŒ–ã¨é‹ç”¨ã‚¬ã‚¤ãƒ‰</title>

  <!-- ã‚µã‚¤ãƒˆå…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¿…ãš1å›ã ã‘ï¼‰ -->

  <link rel="stylesheet" href="/ai-comparison-test-site/style.css" />

  <!-- å¿…è¦æœ€å°é™ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³CSSï¼ˆ20è¡Œä»¥å†…ï¼‰: ãƒ˜ãƒƒãƒ€ãƒ¼è¢«ã‚Šå›é¿ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ç”»åƒã€ãƒ•ã‚§ãƒ¼ãƒ‰ã€ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ -->

  <style>
    /* æœ¬æ–‡ã®ä¸Šéƒ¨ä½™ç™½ã¯ãƒ˜ãƒƒãƒ€ãƒ¼é«˜ã•ã«åˆã‚ã›ã¦JSã§èª¿æ•´ */
    .content { padding:1.25rem; padding-top:var(--header-height,72px); max-width:980px; margin:0 auto; }
    figure img{max-width:100%;height:auto;display:block;}
    .fade-in {opacity:0;transform:translateY(10px);transition:opacity .6s ease, transform .6s ease;}
    .fade-in.visible{opacity:1;transform:none;}
    #to-top{position:fixed;right:1rem;bottom:1.25rem;padding:.6rem .8rem;border-radius:.5rem;box-shadow:0 6px 18px rgba(0,0,0,.12);background:#fff;opacity:0;pointer-events:none;transition:opacity .25s;}
    #to-top.show{opacity:1;pointer-events:auto;}
  </style>

</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€ãŸã‚ã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆ -->
  <div id="header-mount" aria-hidden="true"></div>

  <main id="main" class="content" role="main">
    <!-- ä¸»è¦‹å‡ºã—ï¼ˆçµµæ–‡å­—ã‚’æ§ãˆã‚ã«ï¼‰ -->
    <h1>Algolia ã¨ Lunr.jsï¼šé™çš„ã‚µã‚¤ãƒˆå‘ã‘æ¤œç´¢ã®å°å…¥ã¨è‡ªå‹•åŒ–ã‚¬ã‚¤ãƒ‰ ğŸ”</h1>

```
<!-- ç›®æ¬¡ï¼ˆJSã§è‡ªå‹•ç”Ÿæˆï¼‰ -->
<nav id="table-of-contents" aria-label="ç›®æ¬¡"></nav>

<!-- è¨˜äº‹æœ¬ä½“ -->
<article id="article-body">
  <!-- Algolia ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="fade-in fade-in-target">
    <h2>æ–¹æ³•Bï¼šAlgoliaã§é«˜æ©Ÿèƒ½ãªæ¤œç´¢ã‚’å®Ÿè£…ã™ã‚‹ â˜ï¸</h2>
    <p>é«˜é€Ÿã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ãªã©é«˜åº¦ãªæ¤œç´¢ä½“é¨“ã‚’æä¾›ã—ãŸã„å ´åˆã«ãŠã™ã™ã‚ã§ã™ã€‚ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã‚‚å¤šãã®æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚</p>

    <h3>ã‚¹ãƒ†ãƒƒãƒ—1ï¼šAlgoliaã«ç™»éŒ²ã—ã¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ</h3>
    <p>Algoliaã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€æ–°ã—ã„ <strong>Indexï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰</strong>ï¼ˆä¾‹ï¼š<code>my_website_search</code>ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

    <h3>ã‚¹ãƒ†ãƒƒãƒ—2ï¼šæ¤œç´¢ãƒ‡ãƒ¼ã‚¿ã‚’Algoliaã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
    <p>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€ŒUpload recordsã€ã§ <code>search-index.json</code> ã‚’JSONå½¢å¼ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚Algoliaã§ã¯ <code>objectID</code> ã‚’æ¨å¥¨ã—ã¾ã™ï¼ˆä¾‹ã‚’ä¸‹ã«ç¤ºã—ã¾ã™ï¼‰ã€‚</p>

    <pre><code aria-label="Algoliaç”¨JSONä¾‹">[
```

{
"objectID": 0,
"url": "/about.html",
"title": "ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦",
"content": "ã“ã®ã‚µã‚¤ãƒˆã®é‹å–¶æ–¹é‡ã‚„ç›®çš„ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™..."
}
]</code></pre>

```
    <h3>ã‚¹ãƒ†ãƒƒãƒ—3ï¼šHTMLã«æ¤œç´¢UIã‚’è¨­ç½®ã™ã‚‹</h3>
    <p>AlgoliaãŒæä¾›ã™ã‚‹ InstantSearch.js ã‚’ä½¿ã†ã¨ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã™ã€‚å‚è€ƒCDNï¼ˆä¾‹ï¼‰ï¼š</p>
    <ul>
      <li>algoliasearch: <a href="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js">https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js</a></li>
      <li>instantsearch: <a href="https://cdn.jsdelivr.net/npm/instantsearch.js@4">https://cdn.jsdelivr.net/npm/instantsearch.js@4</a></li>
    </ul>

    <p>HTMLã®è¨­ç½®ä¾‹ï¼š</p>
    <div id="algolia-search-sample" aria-label="Algoliaã‚µãƒ³ãƒ—ãƒ«">
      <h4>Algoliaæ¤œç´¢UIã®è¨­ç½®ä¾‹</h4>
      <div id="search-container">
        <div id="searchbox"></div>
        <div id="hits"></div>
      </div>
      <p class="note">â€» å®Ÿç¨¼åƒã•ã›ã‚‹ã«ã¯ <code>YOUR_APP_ID</code> ã¨ <code>YOUR_SEARCH_ONLY_API_KEY</code>ã€<code>your_index_name</code> ã‚’ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚</p>
    </div>

    <h3>ã‚¹ãƒ†ãƒƒãƒ—4ï¼šInstantSearch ã®åˆæœŸåŒ–ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</h3>
    <pre><code aria-label="InstantSearchã‚µãƒ³ãƒ—ãƒ«">const searchClient = algoliasearch('YOUR_APP_ID','YOUR_SEARCH_ONLY_API_KEY');
```

const search = instantsearch({ indexName: 'your\_index\_name', searchClient });
search.addWidgets(\[
instantsearch.widgets.searchBox({ container: '#searchbox', placeholder: 'ã‚µã‚¤ãƒˆå†…ã‚’æ¤œç´¢...' }),
instantsearch.widgets.hits({ container: '#hits', templates: { item: '<a href="{{url}}"><h3>{{title}}</h3><p>{{content}}</p></a>' } })
]);
search.start();</code></pre> </section>

```
  <!-- è‡ªå‹•åŒ–ï¼ˆGitHub Actionsï¼‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="fade-in fade-in-target">
    <h2>search-index.json ã‚’è‡ªå‹•æ›´æ–°ã™ã‚‹ï¼ˆGitHub Actionsï¼‰ ğŸ¤–</h2>
    <p>ãƒšãƒ¼ã‚¸æ›´æ–°ã”ã¨ã« <code>search-index.json</code> ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œã‚‹æ‰‹é †ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p>

    <h3>ä»•çµ„ã¿ã®æ¦‚è¦</h3>
    <ul>
      <li>Node.js ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ HTML ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã€index ã‚’ç”Ÿæˆ</li>
      <li>GitHub Actions ãŒ push ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ</li>
      <li>ç”Ÿæˆã•ã‚ŒãŸ <code>search-index.json</code> ã‚’è‡ªå‹•ã§ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥</li>
    </ul>

    <h3>Node.js ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ¦‚ç•¥ï¼‰</h3>
    <pre><code aria-label="create-index.jsã®ä¾‹">// glob ã¨ cheerio ã§ HTML ã‚’å·¡å›ã—ã¦ JSON ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆæŠœç²‹ï¼‰
```

const glob = require('glob');
const cheerio = require('cheerio');
// ...ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã€titleã‚„æœ¬æ–‡ã‚’æŠ½å‡ºã—ã¦é…åˆ—ã« push
// æœ€å¾Œã« fs.writeFileSync('./search-index.json', JSON.stringify(articles, null, 2));</code></pre>

```
    <h3>GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆé‡è¦ãªæ¨©é™è¨­å®šï¼‰</h3>
    <p>Actions ãŒãƒªãƒã‚¸ãƒˆãƒªã¸ã‚³ãƒŸãƒƒãƒˆã™ã‚‹å ´åˆã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…ˆé ­ã« <code>permissions: contents: write</code> ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
    <pre><code aria-label="workflowä¾‹">on:
```

push:
branches: \[ main ]
permissions:
contents: write
jobs:
build: ...</code></pre>

```
    <p>â€» å®Ÿè¡Œå¾Œã¯ GitHub ã® <strong>Actions</strong> ã‚¿ãƒ–ã§ãƒ­ã‚°ã‚’ç¢ºèªã—ã€æˆåŠŸï¼ˆç·‘ï¼‰ã‹å¤±æ•—ï¼ˆèµ¤ï¼‰ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
  </section>

  <!-- Git/Push/èªè¨¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ -->
  <section class="fade-in fade-in-target">
    <h2>GitHub ã¸ãƒ—ãƒƒã‚·ãƒ¥ã§ããªã„æ™‚ã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ ğŸ”§</h2>
    <p>ã‚ˆãã‚ã‚‹åŸå› ï¼š</p>
    <ul>
      <li>ãƒªãƒ¢ãƒ¼ãƒˆ URL ã®èª¤ã‚Š</li>
      <li>èªè¨¼æƒ…å ±ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ãŒç„¡åŠ¹</li>
      <li>Actions ã«æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„</li>
    </ul>

    <h3>ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã® push ãŒ 403 ã«ãªã‚‹å ´åˆ</h3>
    <p>GitHub ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä»£ã‚ã‚Šã« <strong>Personal Access Tokenï¼ˆPATï¼‰</strong> ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆã—ã€push æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

    <h3>Windows ã§è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ</h3>
    <p>ã€Œ<kbd>Windows</kbd> + <kbd>R</kbd>ã€ã§ <code>control /name Microsoft.CredentialManager</code> ã‚’å®Ÿè¡Œã—ã¦é–‹ãã‹ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§ä¸€æ™‚çš„ã« credential.helper ã‚’ç„¡åŠ¹åŒ–ã—ã¦ç›´æ¥èªè¨¼ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚</p>
    <pre><code aria-label="gitã‚³ãƒãƒ³ãƒ‰ä¾‹">git config --global --unset credential.helper
```

git push

# ãƒ¦ãƒ¼ã‚¶ãƒ¼å: your-username

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: (PAT ã‚’è²¼ã‚Šä»˜ã‘)

git config --global credential.helper manager</code></pre> </section>

```
  <!-- ã¾ã¨ã‚ -->
  <section class="fade-in fade-in-target">
    <h2>ã¾ã¨ã‚ âœ…</h2>
    <p>Lunr.jsï¼ˆå®Œå…¨è‡ªå·±å®Œçµå‹ï¼‰ã¯å°ã€œä¸­è¦æ¨¡ã‚µã‚¤ãƒˆã«æœ€é©ã€Algoliaï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã¯å¤§è¦æ¨¡ãƒ»é«˜æ©Ÿèƒ½å‘ã‘ã€‚search-index.json ã®è‡ªå‹•åŒ–ã¯ GitHub Actions ã¨ç°¡å˜ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®Ÿç¾ã§ãã¾ã™ã€‚</p>
    <blockquote>
      <p>å¿…è¦ãªã‚‰ã€Lunr.js ã‚’ä½¿ã£ãŸæ¤œç´¢UIã®ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ãï¼‰ã‚‚åŒã˜ãƒšãƒ¼ã‚¸ã«è¨­ç½®ã§ãã¾ã™ã€‚ã”å¸Œæœ›ãªã‚‰ãã®ã‚³ãƒ¼ãƒ‰ã‚’åæ˜ ã—ã¾ã™ã€‚</p>
    </blockquote>
  </section>
</article>
```

  </main>

  <!-- ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œã€aria-labelä»˜ä¸ï¼‰ -->

<button id="to-top" aria-label="ãƒšãƒ¼ã‚¸ã®å…ˆé ­ã¸æˆ»ã‚‹">â†‘ ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>

  <!-- JavaScriptï¼šãƒ˜ãƒƒãƒ€ãƒ¼èª­ã¿è¾¼ã¿ã€ç›®æ¬¡ç”Ÿæˆã€IntersectionObserverã€ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹ç­‰ï¼ˆè¦ç‚¹ã‚’ã‚³ãƒ¡ãƒ³ãƒˆï¼‰ -->

  <script>
    /* ============================================================
       ãƒ˜ãƒƒãƒ€ãƒ¼ã®å‹•çš„èª­ã¿è¾¼ã¿
       - fetch + DOMParser ã‚’ä½¿ã„ /ai-comparison-test-site/header.html ã‚’å–å¾—
       - header å†…ã®ä¸»è¦ãƒãƒ¼ãƒ‰ã‚’ #header-mount ã«æŒ¿å…¥
       - æŒ¿å…¥å¾Œã«é«˜ã•ã‚’è¨ˆæ¸¬ã—ã¦ CSS å¤‰æ•° --header-height ã‚’è¨­å®šï¼ˆå›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼å¯¾ç­–ï¼‰
    ============================================================ */
    (async function loadHeader(){
      try {
        const mount = document.getElementById('header-mount');
        const res = await fetch('/ai-comparison-test-site/header.html', {cache:'no-cache'});
        if(!res.ok) throw new Error('header fetch failed');
        const html = await res.text();
        const doc = new DOMParser().parseFromString(html, 'text/html');
        // å„ªå…ˆã—ã¦ .site-headerã€æ¬¡ã« body ã®ä¸­èº«ã‚’ä½¿ç”¨
        const candidate = doc.querySelector('.site-header') || doc.body;
        // æ—¢å­˜å­ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰æŒ¿å…¥
        while(mount.firstChild) mount.removeChild(mount.firstChild);
        Array.from(candidate.childNodes).forEach(n => mount.appendChild(n.cloneNode(true)));
        // é«˜ã•ã‚’è¨­å®šï¼ˆå°‘ã—ä½™è£•ã‚’å«ã‚ã‚‹ï¼‰
        requestAnimationFrame(()=>{
          const el = mount.firstElementChild || mount;
          const h = Math.ceil(el.getBoundingClientRect().height) + 8;
          document.documentElement.style.setProperty('--header-height', h + 'px');
          mount.setAttribute('aria-hidden','false');
        });
      } catch (e) {
        console.error('ãƒ˜ãƒƒãƒ€ãƒ¼èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
      }
    })();

    /* ============================================================
       ç›®æ¬¡ï¼ˆTOCï¼‰è‡ªå‹•ç”Ÿæˆ
       - article å†…ã® h2,h3 ã‚’æŠ½å‡º
       - å„è¦‹å‡ºã—ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯IDã‚’ä»˜ä¸ï¼ˆã‚¹ãƒ©ãƒƒã‚°åŒ–ï¼‹é‡è¤‡å›é¿ï¼‰
       - h1 ã®ç›´å¾Œã« TOC ã‚’æŒ¿å…¥
    ============================================================ */
    (function buildTOC(){
      function slugify(s){
        return s.toString().toLowerCase().trim()
          .replace(/[^\w\u3040-\u30ff\u4e00-\u9fff\- ]+/g,'')
          .replace(/\s+/g,'-').replace(/\-+/g,'-');
      }
      const article = document.getElementById('article-body');
      if(!article) return;
      const headings = article.querySelectorAll('h2,h3');
      if(headings.length === 0) return;
      const ul = document.createElement('ul');
      ul.className = 'toc-list';
      const used = new Set();
      headings.forEach(h=>{
        if(!h.id){
          let base = slugify(h.textContent || 'heading');
          let id = base;
          let i = 1;
          while(used.has(id) || document.getElementById(id)){
            id = base + '-' + i++;
          }
          used.add(id);
          h.id = id;
        }
        const li = document.createElement('li');
        li.className = 'toc-' + h.tagName.toLowerCase();
        const a = document.createElement('a');
        a.href = '#' + h.id;
        a.textContent = (h.tagName.toLowerCase() === 'h2' ? 'â–  ' : 'â€“ ') + h.textContent;
        a.setAttribute('aria-label','ç›®æ¬¡: '+h.textContent);
        li.appendChild(a);
        ul.appendChild(li);
      });
      // TOC ã‚’ h1 ã®ç›´å¾Œã«æŒ¿å…¥
      const h1 = document.querySelector('h1');
      const wrapper = document.createElement('nav');
      wrapper.id = 'toc';
      wrapper.setAttribute('aria-label','ãƒšãƒ¼ã‚¸å†…ç›®æ¬¡');
      wrapper.className = 'fade-in fade-in-target';
      const title = document.createElement('p');
      title.textContent = 'ç›®æ¬¡ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•ï¼‰';
      wrapper.appendChild(title);
      wrapper.appendChild(ul);
      if(h1 && h1.parentNode) h1.insertAdjacentElement('afterend', wrapper);
      else document.getElementById('table-of-contents').appendChild(wrapper);
    })();

    /* ============================================================
       ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆIntersectionObserverï¼‰
       - .fade-in-target ã‚’ç›£è¦–ã—ã€ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã«å…¥ã£ãŸã‚‰ .visible ã‚’ä»˜ä¸
       - ä¸€åº¦è¡¨ç¤ºã—ãŸã‚‰ unobserve ã—ã¦ç„¡é§„ãªå‡¦ç†ã‚’æ¸›ã‚‰ã™
    ============================================================ */
    (function initFadeIn(){
      const targets = document.querySelectorAll('.fade-in-target');
      if(!targets.length) return;
      const io = new IntersectionObserver((entries, obs)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            entry.target.classList.add('visible');
            obs.unobserve(entry.target);
          }
        });
      }, {threshold: 0.12});
      targets.forEach(t=>io.observe(t));
    })();

    /* ============================================================
       ã€Œãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³
       - 1ç”»é¢åˆ†ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã‚‰å³ä¸‹ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³è¡¨ç¤º
       - ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã«ã‚‚å¯¾å¿œ
    ============================================================ */
    (function initToTop(){
      const btn = document.getElementById('to-top');
      if(!btn) return;
      function check(){
        if(window.scrollY > window.innerHeight) btn.classList.add('show');
        else btn.classList.remove('show');
      }
      window.addEventListener('scroll', check, {passive:true});
      window.addEventListener('resize', check);
      check();
      btn.addEventListener('click', ()=>{ window.scrollTo({top:0,behavior:'smooth'}); btn.blur(); });
      btn.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); btn.click(); }});
    })();

    /* ============================================================
       ãƒãƒƒã‚·ãƒ¥ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆè£œæ­£ï¼ˆå›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼å¯¾ç­–ï¼‰
       - ãƒšãƒ¼ã‚¸å†…ãƒªãƒ³ã‚¯ã§é·ç§»ã—ãŸéš›ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã§éš ã‚Œãªã„ã‚ˆã†ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«èª¿æ•´
    ============================================================ */
    (function adjustHashOffset(){
      function offsetToHash(){
        if(location.hash){
          const el = document.getElementById(location.hash.slice(1));
          if(el){
            const headerH = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-height')) || 72;
            const rect = el.getBoundingClientRect();
            const top = window.scrollY + rect.top - headerH - 12;
            window.scrollTo({top, behavior:'smooth'});
          }
        }
      }
      window.addEventListener('load', ()=>setTimeout(offsetToHash, 80));
      document.addEventListener('click', e=>{
        const a = e.target.closest('a[href^="#"]');
        if(a) setTimeout(offsetToHash, 10);
      });
    })();
  </script>

</body>
</html>
